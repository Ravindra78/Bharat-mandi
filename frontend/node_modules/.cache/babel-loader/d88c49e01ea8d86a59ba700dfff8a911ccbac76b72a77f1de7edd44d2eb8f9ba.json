{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport { messaging, getToken, onMessage } from '../firebase';\nimport { apiFetch } from '../services/api';\nimport { useSelector } from 'react-redux';\nconst useNotifications = () => {\n  _s();\n  const {\n    user\n  } = useSelector(state => state.auth);\n  const [notificationPermission, setNotificationPermission] = useState('default');\n  useEffect(() => {\n    if (user) {\n      const requestPermission = async () => {\n        try {\n          const permission = await Notification.requestPermission();\n          setNotificationPermission(permission);\n          if (permission === 'granted') {\n            const token = await getToken(messaging, {\n              vapidKey: process.env.REACT_APP_FIREBASE_VAPID_KEY\n            });\n            await apiFetch('/users/fcm-token', {\n              method: 'POST',\n              body: JSON.stringify({\n                fcmToken: token\n              })\n            });\n          }\n        } catch (err) {\n          console.error('Notification error:', err);\n        }\n      };\n      requestPermission();\n      onMessage(messaging, payload => {\n        alert(`${payload.notification.title}: ${payload.notification.body}`);\n      });\n    }\n  }, [user]);\n  return {\n    notificationPermission\n  };\n};\n_s(useNotifications, \"WS+x0F9lcsSoiQDeRf+gtzGSR/w=\", false, function () {\n  return [useSelector];\n});\nexport default useNotifications;","map":{"version":3,"names":["useEffect","useState","messaging","getToken","onMessage","apiFetch","useSelector","useNotifications","_s","user","state","auth","notificationPermission","setNotificationPermission","requestPermission","permission","Notification","token","vapidKey","process","env","REACT_APP_FIREBASE_VAPID_KEY","method","body","JSON","stringify","fcmToken","err","console","error","payload","alert","notification","title"],"sources":["/Users/deepakmeena/Desktop/BharatMandi/frontend/src/hooks/useNotifications.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { messaging, getToken, onMessage } from '../firebase';\r\nimport { apiFetch } from '../services/api';\r\nimport { useSelector } from 'react-redux';\r\n\r\nconst useNotifications = () => {\r\n  const { user } = useSelector((state) => state.auth);\r\n  const [notificationPermission, setNotificationPermission] = useState('default');\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      const requestPermission = async () => {\r\n        try {\r\n          const permission = await Notification.requestPermission();\r\n          setNotificationPermission(permission);\r\n          if (permission === 'granted') {\r\n            const token = await getToken(messaging, { vapidKey: process.env.REACT_APP_FIREBASE_VAPID_KEY });\r\n            await apiFetch('/users/fcm-token', {\r\n              method: 'POST',\r\n              body: JSON.stringify({ fcmToken: token }),\r\n            });\r\n          }\r\n        } catch (err) {\r\n          console.error('Notification error:', err);\r\n        }\r\n      };\r\n      requestPermission();\r\n\r\n      onMessage(messaging, (payload) => {\r\n        alert(`${payload.notification.title}: ${payload.notification.body}`);\r\n      });\r\n    }\r\n  }, [user]);\r\n\r\n  return { notificationPermission };\r\n};\r\n\r\nexport default useNotifications;"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,SAASC,SAAS,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,aAAa;AAC5D,SAASC,QAAQ,QAAQ,iBAAiB;AAC1C,SAASC,WAAW,QAAQ,aAAa;AAEzC,MAAMC,gBAAgB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC7B,MAAM;IAAEC;EAAK,CAAC,GAAGH,WAAW,CAAEI,KAAK,IAAKA,KAAK,CAACC,IAAI,CAAC;EACnD,MAAM,CAACC,sBAAsB,EAAEC,yBAAyB,CAAC,GAAGZ,QAAQ,CAAC,SAAS,CAAC;EAE/ED,SAAS,CAAC,MAAM;IACd,IAAIS,IAAI,EAAE;MACR,MAAMK,iBAAiB,GAAG,MAAAA,CAAA,KAAY;QACpC,IAAI;UACF,MAAMC,UAAU,GAAG,MAAMC,YAAY,CAACF,iBAAiB,CAAC,CAAC;UACzDD,yBAAyB,CAACE,UAAU,CAAC;UACrC,IAAIA,UAAU,KAAK,SAAS,EAAE;YAC5B,MAAME,KAAK,GAAG,MAAMd,QAAQ,CAACD,SAAS,EAAE;cAAEgB,QAAQ,EAAEC,OAAO,CAACC,GAAG,CAACC;YAA6B,CAAC,CAAC;YAC/F,MAAMhB,QAAQ,CAAC,kBAAkB,EAAE;cACjCiB,MAAM,EAAE,MAAM;cACdC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;gBAAEC,QAAQ,EAAET;cAAM,CAAC;YAC1C,CAAC,CAAC;UACJ;QACF,CAAC,CAAC,OAAOU,GAAG,EAAE;UACZC,OAAO,CAACC,KAAK,CAAC,qBAAqB,EAAEF,GAAG,CAAC;QAC3C;MACF,CAAC;MACDb,iBAAiB,CAAC,CAAC;MAEnBV,SAAS,CAACF,SAAS,EAAG4B,OAAO,IAAK;QAChCC,KAAK,CAAC,GAAGD,OAAO,CAACE,YAAY,CAACC,KAAK,KAAKH,OAAO,CAACE,YAAY,CAACT,IAAI,EAAE,CAAC;MACtE,CAAC,CAAC;IACJ;EACF,CAAC,EAAE,CAACd,IAAI,CAAC,CAAC;EAEV,OAAO;IAAEG;EAAuB,CAAC;AACnC,CAAC;AAACJ,EAAA,CA9BID,gBAAgB;EAAA,QACHD,WAAW;AAAA;AA+B9B,eAAeC,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}